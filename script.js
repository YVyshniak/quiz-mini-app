const allQuestions = [{"q": "Питання №1: Що є правильним?", "a": ["Неправильна 1-1", "Неправильна 1-2", "Правильна 1"], "correct": "Правильна 1"}, {"q": "Питання №2: Що є правильним?", "a": ["Правильна 2", "Неправильна 2-1", "Неправильна 2-2"], "correct": "Правильна 2"}, {"q": "Питання №3: Що є правильним?", "a": ["Правильна 3", "Неправильна 3-1", "Неправильна 3-2"], "correct": "Правильна 3"}, {"q": "Питання №4: Що є правильним?", "a": ["Неправильна 4-2", "Правильна 4", "Неправильна 4-1"], "correct": "Правильна 4"}, {"q": "Питання №5: Що є правильним?", "a": ["Неправильна 5-1", "Правильна 5", "Неправильна 5-2"], "correct": "Правильна 5"}, {"q": "Питання №6: Що є правильним?", "a": ["Неправильна 6-2", "Неправильна 6-1", "Правильна 6"], "correct": "Правильна 6"}, {"q": "Питання №7: Що є правильним?", "a": ["Правильна 7", "Неправильна 7-2", "Неправильна 7-1"], "correct": "Правильна 7"}, {"q": "Питання №8: Що є правильним?", "a": ["Правильна 8", "Неправильна 8-2", "Неправильна 8-1"], "correct": "Правильна 8"}, {"q": "Питання №9: Що є правильним?", "a": ["Неправильна 9-2", "Правильна 9", "Неправильна 9-1"], "correct": "Правильна 9"}, {"q": "Питання №10: Що є правильним?", "a": ["Неправильна 10-1", "Правильна 10", "Неправильна 10-2"], "correct": "Правильна 10"}, {"q": "Питання №11: Що є правильним?", "a": ["Неправильна 11-2", "Неправильна 11-1", "Правильна 11"], "correct": "Правильна 11"}, {"q": "Питання №12: Що є правильним?", "a": ["Неправильна 12-1", "Неправильна 12-2", "Правильна 12"], "correct": "Правильна 12"}, {"q": "Питання №13: Що є правильним?", "a": ["Неправильна 13-1", "Правильна 13", "Неправильна 13-2"], "correct": "Правильна 13"}, {"q": "Питання №14: Що є правильним?", "a": ["Неправильна 14-1", "Неправильна 14-2", "Правильна 14"], "correct": "Правильна 14"}, {"q": "Питання №15: Що є правильним?", "a": ["Правильна 15", "Неправильна 15-2", "Неправильна 15-1"], "correct": "Правильна 15"}, {"q": "Питання №16: Що є правильним?", "a": ["Неправильна 16-1", "Правильна 16", "Неправильна 16-2"], "correct": "Правильна 16"}, {"q": "Питання №17: Що є правильним?", "a": ["Правильна 17", "Неправильна 17-2", "Неправильна 17-1"], "correct": "Правильна 17"}, {"q": "Питання №18: Що є правильним?", "a": ["Неправильна 18-2", "Правильна 18", "Неправильна 18-1"], "correct": "Правильна 18"}, {"q": "Питання №19: Що є правильним?", "a": ["Правильна 19", "Неправильна 19-2", "Неправильна 19-1"], "correct": "Правильна 19"}, {"q": "Питання №20: Що є правильним?", "a": ["Неправильна 20-1", "Неправильна 20-2", "Правильна 20"], "correct": "Правильна 20"}, {"q": "Питання №21: Що є правильним?", "a": ["Неправильна 21-2", "Неправильна 21-1", "Правильна 21"], "correct": "Правильна 21"}, {"q": "Питання №22: Що є правильним?", "a": ["Неправильна 22-2", "Правильна 22", "Неправильна 22-1"], "correct": "Правильна 22"}, {"q": "Питання №23: Що є правильним?", "a": ["Неправильна 23-1", "Правильна 23", "Неправильна 23-2"], "correct": "Правильна 23"}, {"q": "Питання №24: Що є правильним?", "a": ["Правильна 24", "Неправильна 24-2", "Неправильна 24-1"], "correct": "Правильна 24"}, {"q": "Питання №25: Що є правильним?", "a": ["Неправильна 25-1", "Правильна 25", "Неправильна 25-2"], "correct": "Правильна 25"}, {"q": "Питання №26: Що є правильним?", "a": ["Неправильна 26-2", "Правильна 26", "Неправильна 26-1"], "correct": "Правильна 26"}, {"q": "Питання №27: Що є правильним?", "a": ["Неправильна 27-1", "Неправильна 27-2", "Правильна 27"], "correct": "Правильна 27"}, {"q": "Питання №28: Що є правильним?", "a": ["Неправильна 28-1", "Правильна 28", "Неправильна 28-2"], "correct": "Правильна 28"}, {"q": "Питання №29: Що є правильним?", "a": ["Правильна 29", "Неправильна 29-2", "Неправильна 29-1"], "correct": "Правильна 29"}, {"q": "Питання №30: Що є правильним?", "a": ["Правильна 30", "Неправильна 30-1", "Неправильна 30-2"], "correct": "Правильна 30"}, {"q": "Питання №31: Що є правильним?", "a": ["Неправильна 31-1", "Неправильна 31-2", "Правильна 31"], "correct": "Правильна 31"}, {"q": "Питання №32: Що є правильним?", "a": ["Неправильна 32-1", "Неправильна 32-2", "Правильна 32"], "correct": "Правильна 32"}, {"q": "Питання №33: Що є правильним?", "a": ["Неправильна 33-1", "Правильна 33", "Неправильна 33-2"], "correct": "Правильна 33"}, {"q": "Питання №34: Що є правильним?", "a": ["Неправильна 34-1", "Правильна 34", "Неправильна 34-2"], "correct": "Правильна 34"}, {"q": "Питання №35: Що є правильним?", "a": ["Правильна 35", "Неправильна 35-2", "Неправильна 35-1"], "correct": "Правильна 35"}, {"q": "Питання №36: Що є правильним?", "a": ["Неправильна 36-1", "Правильна 36", "Неправильна 36-2"], "correct": "Правильна 36"}, {"q": "Питання №37: Що є правильним?", "a": ["Неправильна 37-1", "Правильна 37", "Неправильна 37-2"], "correct": "Правильна 37"}, {"q": "Питання №38: Що є правильним?", "a": ["Неправильна 38-2", "Правильна 38", "Неправильна 38-1"], "correct": "Правильна 38"}, {"q": "Питання №39: Що є правильним?", "a": ["Неправильна 39-2", "Правильна 39", "Неправильна 39-1"], "correct": "Правильна 39"}, {"q": "Питання №40: Що є правильним?", "a": ["Неправильна 40-1", "Неправильна 40-2", "Правильна 40"], "correct": "Правильна 40"}, {"q": "Питання №41: Що є правильним?", "a": ["Неправильна 41-1", "Неправильна 41-2", "Правильна 41"], "correct": "Правильна 41"}, {"q": "Питання №42: Що є правильним?", "a": ["Правильна 42", "Неправильна 42-2", "Неправильна 42-1"], "correct": "Правильна 42"}, {"q": "Питання №43: Що є правильним?", "a": ["Неправильна 43-2", "Правильна 43", "Неправильна 43-1"], "correct": "Правильна 43"}, {"q": "Питання №44: Що є правильним?", "a": ["Неправильна 44-2", "Правильна 44", "Неправильна 44-1"], "correct": "Правильна 44"}, {"q": "Питання №45: Що є правильним?", "a": ["Правильна 45", "Неправильна 45-2", "Неправильна 45-1"], "correct": "Правильна 45"}, {"q": "Питання №46: Що є правильним?", "a": ["Правильна 46", "Неправильна 46-1", "Неправильна 46-2"], "correct": "Правильна 46"}, {"q": "Питання №47: Що є правильним?", "a": ["Неправильна 47-1", "Неправильна 47-2", "Правильна 47"], "correct": "Правильна 47"}, {"q": "Питання №48: Що є правильним?", "a": ["Неправильна 48-1", "Неправильна 48-2", "Правильна 48"], "correct": "Правильна 48"}, {"q": "Питання №49: Що є правильним?", "a": ["Неправильна 49-2", "Неправильна 49-1", "Правильна 49"], "correct": "Правильна 49"}, {"q": "Питання №50: Що є правильним?", "a": ["Неправильна 50-1", "Неправильна 50-2", "Правильна 50"], "correct": "Правильна 50"}];
Telegram.WebApp.ready();

let selectedQuestions = [];
let current = 0;
let score = 0;
const questionTitle = document.getElementById("question-title");
const answersContainer = document.getElementById("answers");
const resultEl = document.getElementById("result");
const restartBtn = document.getElementById("restart-btn");

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function startQuiz() {
  score = 0;
  current = 0;
  resultEl.classList.add("hidden");
  restartBtn.classList.add("hidden");
  Telegram.WebApp.MainButton.hide();
  selectedQuestions = [...allQuestions];
  shuffle(selectedQuestions);
  selectedQuestions = selectedQuestions.slice(0, 10);
  showQuestion();
}

function showQuestion() {
  const q = selectedQuestions[current];
  questionTitle.textContent = "Питання " + (current + 1) + " з 10: " + q.q;
  answersContainer.innerHTML = "";
  q.a.forEach(ans => {
    const btn = document.createElement("button");
    btn.textContent = ans;
    btn.onclick = () => handleAnswer(btn, ans);
    answersContainer.appendChild(btn);
  });
}

function handleAnswer(button, answer) {
  const q = selectedQuestions[current];
  const buttons = answersContainer.querySelectorAll("button");
  buttons.forEach(btn => {
    btn.disabled = true;
    if (btn.textContent === q.correct) {
      btn.classList.add("correct");
    } else if (btn === button) {
      btn.classList.add("incorrect");
    }
  });
  if (answer === q.correct) score++;
  current++;
  setTimeout(() => {
    if (current < 10) {
      showQuestion();
    } else {
      endQuiz();
    }
  }, 1000);
}

function endQuiz() {
  questionTitle.textContent = "Вікторина завершена!";
  answersContainer.innerHTML = "";
  resultEl.textContent = "Ваш результат: " + score + " з 10";
  resultEl.classList.remove("hidden");
  restartBtn.classList.remove("hidden");

  Telegram.WebApp.MainButton.setText("Надіслати результат").show();
  Telegram.WebApp.MainButton.onClick(() => {
    Telegram.WebApp.sendData(JSON.stringify({
      score: score,
      total: 10
    }));
    Telegram.WebApp.close();
  });
}

restartBtn.onclick = startQuiz;
startQuiz();
